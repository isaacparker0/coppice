import workspace/auth { Incrementer, Token, START_ID, makeToken, identity, Box, Maybe }

function idOf(token: Token) -> int64 {
    return token.bump(0)
}

function idPlusOne(value: Incrementer) -> int64 {
    return value.bump(1)
}

function run() -> int64 {
    token := makeToken(START_ID)
    bumped := token.bump(1)
    maybeBumped: Maybe[int64] := identity[int64](bumped)
    boxed := Box[int64] { value: identity[int64](bumped) }
    if maybeBumped == nil {
        return idPlusOne(token)
    }
    return idOf(token) + boxed.get()
}
