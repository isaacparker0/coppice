import workspace/lib { plusTwo }

function describe(ready: boolean) -> string {
    if ready {
        return "ready"
    }
    return "not ready"
}

function apply(value: int64, mapper: function(int64) -> int64) -> int64 {
    return mapper(value)
}

function plusOne(value: int64) -> int64 {
    return value + 1
}

function addTwo(mut value: int64) -> int64 {
    value = value + 2
    return value
}

function identity[T](value: T) -> T {
    return value
}

type Maybe[T] :: T | nil

function coalesce[T](value: Maybe[T], fallback: T) -> T {
    if value != nil {
        return value
    }
    return fallback
}

function main() -> nil {
    localMapper: function(int64) -> int64 := plusOne
    importedMapper: function(int64) -> int64 := plusTwo

    first := apply(7, localMapper)
    second := apply(first, importedMapper)
    print(string(addTwo(8)))

    print(describe(true))
    if second == 10 {
        print("value 10")
    } else {
        print("value not 10")
    }

    print(string(coalesce[int64](nil, 9)))
    print(string(coalesce[int64](5, 9)))

    print(string(identity[int64](7)))
    print(identity[string]("id ok"))
    print(string(identity[boolean](true)))

    return nil
}
